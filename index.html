<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem Inventory & POS - Version 37 Fixed</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        input, textarea, select {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        body { 
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            touch-action: manipulation;
        }
        
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
        }
        
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .login-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .receipt-print { font-family: 'Courier New', monospace; }
        
        button, .btn {
            min-height: 44px;
            min-width: 44px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            transform: translateZ(0);
            backface-visibility: hidden;
        }
        
        button:active, .btn:active {
            transform: scale(0.98) translateZ(0);
            transition: transform 0.1s ease;
        }
        
        button:focus, .btn:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        input, select, textarea {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            font-size: 16px;
            min-height: 44px;
            touch-action: manipulation;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            ring: 2px;
            ring-color: #3b82f6;
            border-color: transparent;
            transform: translateZ(0);
        }
        
        .mobile-nav { display: none; }
        @media (max-width: 768px) {
            .mobile-nav { display: block; }
            .desktop-nav { display: none; }
            .nav-btn { 
                display: block; 
                width: 100%; 
                text-align: left; 
                padding: 16px; 
                border-left: 4px solid transparent;
                border-bottom: none !important;
                transition: all 0.2s ease;
                min-height: 56px;
                touch-action: manipulation;
            }
            .nav-btn.active {
                border-left-color: #3b82f6 !important;
                background-color: #eff6ff;
                color: #3b82f6 !important;
            }
            .nav-btn:hover, .nav-btn:active {
                background-color: #f3f4f6;
                transform: translateX(4px);
            }
        }
        
        .modal-overlay {
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }
        
        .form-control {
            font-size: 16px;
            padding: 12px 16px;
            min-height: 48px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            transition: all 0.2s ease;
            background-color: white;
        }
        
        .form-control:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            transform: translateZ(0);
        }
        
        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 6px;
            display: block;
        }
        
        .section-content {
            display: none !important;
        }
        
        .section-content.active {
            display: block !important;
        }
        
        .nav-btn {
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .nav-btn.active {
            color: #3b82f6 !important;
            border-bottom-color: #3b82f6 !important;
        }
        
        @media (max-width: 640px) {
            .modal-content {
                margin: 0.5rem;
                max-height: calc(100vh - 1rem);
                overflow-y: auto;
                border-radius: 1rem;
                transform: translateZ(0);
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="login-bg min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-6 sm:p-8 w-full max-w-md mx-auto">
            <div class="text-center mb-6 sm:mb-8">
                <div class="bg-blue-500 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                </div>
                <h1 class="text-xl sm:text-2xl font-bold text-gray-900 mb-2">Sistem Inventory & POS</h1>
                <p class="text-sm sm:text-base text-gray-600">Version 37 - Fixed System</p>
            </div>
            
            <form id="loginForm" class="space-y-4 sm:space-y-6">
                <div>
                    <label class="form-label">Username</label>
                    <input type="text" id="username" required class="form-control w-full" placeholder="Masukkan username" autocomplete="username">
                </div>
                <div>
                    <label class="form-label">Password</label>
                    <input type="password" id="password" required class="form-control w-full" placeholder="Masukkan password" autocomplete="current-password">
                </div>
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 min-h-[48px]">
                    Login
                </button>
            </form>
            

            
            <!-- LocalStorage Info -->
            <div class="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                <div class="flex items-start">
                    <svg class="w-4 h-4 text-green-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <div class="text-xs text-green-700">
                        <p class="font-medium mb-1">LocalStorage System Ready!</p>
                        <p>Data disimpan di browser dengan sistem backup/restore lengkap.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-lg border-b-4 border-blue-500">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-3 md:py-4">
                    <div class="flex items-center space-x-2 md:space-x-3">
                        <div class="bg-blue-500 p-1.5 md:p-2 rounded-lg">
                            <svg class="w-6 h-6 md:w-8 md:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-lg md:text-xl font-bold text-gray-900">Sistem Inventory & POS</h1>
                            <p class="text-xs md:text-sm text-gray-600" id="userRole">Admin Dashboard</p>
                        </div>
                        <button onclick="toggleMobileNav()" class="md:hidden ml-4 p-2 rounded-lg bg-gray-100 min-w-[44px] min-h-[44px] flex items-center justify-center">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="flex items-center space-x-2 md:space-x-4">
                        <span class="text-xs md:text-sm text-gray-600 hidden sm:block" id="currentUser">Selamat datang, Admin</span>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg transition duration-200 text-sm min-h-[44px]">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b">
            <!-- Desktop Navigation -->
            <div class="desktop-nav max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8">
                    <button onclick="showSection('dashboard')" class="nav-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium active">
                        Dashboard
                    </button>
                    <button onclick="showSection('inventory')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium" id="inventoryNav">
                        Inventory
                    </button>
                    <button onclick="showSection('pos')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        Point of Sale
                    </button>
                    <button onclick="showSection('reports')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium" id="reportsNav">
                        Laporan
                    </button>
                    <button onclick="showSection('database')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium">
                        Database
                    </button>
                    <button onclick="showSection('settings')" class="nav-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium" id="settingsNav">
                        Pengaturan
                    </button>
                </div>
            </div>
            
            <!-- Mobile Navigation -->
            <div class="mobile-nav hidden" id="mobileNav">
                <div class="px-4 py-2 space-y-1">
                    <button onclick="showSection('dashboard')" class="nav-btn active">
                        <svg class="w-5 h-5 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                        </svg>
                        Dashboard
                    </button>
                    <button onclick="showSection('inventory')" class="nav-btn" id="inventoryNavMobile">
                        <svg class="w-5 h-5 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                        </svg>
                        Inventory
                    </button>
                    <button onclick="showSection('pos')" class="nav-btn">
                        <svg class="w-5 h-5 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                        </svg>
                        Point of Sale
                    </button>
                    <button onclick="showSection('reports')" class="nav-btn" id="reportsNavMobile">
                        <svg class="w-5 h-5 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        Laporan
                    </button>
                    <button onclick="showSection('database')" class="nav-btn">
                        <svg class="w-5 h-5 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path>
                        </svg>
                        Database
                    </button>
                    <button onclick="showSection('settings')" class="nav-btn" id="settingsNavMobile">
                        <svg class="w-5 h-5 inline-block mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Pengaturan
                    </button>
                </div>
            </div>
        </nav>

        <!-- Dashboard Section -->
        <div id="dashboardSection" class="section-content active max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8">
            <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
                <div class="bg-white rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-blue-500">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-1.5 md:p-3 rounded-full flex-shrink-0">
                            <svg class="w-4 h-4 md:w-6 md:h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                            </svg>
                        </div>
                        <div class="ml-2 md:ml-4 min-w-0 flex-1">
                            <p class="text-xs md:text-sm font-medium text-gray-600 truncate">Total Produk</p>
                            <p class="text-lg md:text-2xl font-bold text-gray-900" id="totalProducts">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-green-500">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-1.5 md:p-3 rounded-full flex-shrink-0">
                            <svg class="w-4 h-4 md:w-6 md:h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                            </svg>
                        </div>
                        <div class="ml-2 md:ml-4 min-w-0 flex-1">
                            <p class="text-xs md:text-sm font-medium text-gray-600 truncate">Penjualan Hari Ini</p>
                            <p class="text-lg md:text-2xl font-bold text-gray-900" id="todaySales">Rp 0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-yellow-500">
                    <div class="flex items-center">
                        <div class="bg-yellow-100 p-1.5 md:p-3 rounded-full flex-shrink-0">
                            <svg class="w-4 h-4 md:w-6 md:h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <div class="ml-2 md:ml-4 min-w-0 flex-1">
                            <p class="text-xs md:text-sm font-medium text-gray-600 truncate">Stok Menipis</p>
                            <p class="text-lg md:text-2xl font-bold text-gray-900" id="lowStock">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-3 md:p-6 border-l-4 border-purple-500">
                    <div class="flex items-center">
                        <div class="bg-purple-100 p-1.5 md:p-3 rounded-full flex-shrink-0">
                            <svg class="w-4 h-4 md:w-6 md:h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                        </div>
                        <div class="ml-2 md:ml-4 min-w-0 flex-1">
                            <p class="text-xs md:text-sm font-medium text-gray-600 truncate">Total Transaksi</p>
                            <p class="text-lg md:text-2xl font-bold text-gray-900" id="totalTransactions">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
                <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                    <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4">Produk Terlaris</h3>
                    <div id="topProducts" class="space-y-3">
                        <p class="text-gray-500 text-center py-8">Belum ada data penjualan</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                    <h3 class="text-base md:text-lg font-semibold text-gray-900 mb-4">Aktivitas Terbaru</h3>
                    <div id="recentActivity" class="space-y-3">
                        <p class="text-gray-500 text-center py-8">Belum ada aktivitas</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Inventory Section -->
        <div id="inventorySection" class="section-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 md:mb-6 gap-4">
                <h2 class="text-xl md:text-2xl font-bold text-gray-900">Manajemen Inventory</h2>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 w-full sm:w-auto">
                    <button onclick="exportInventory()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg transition duration-200 text-sm min-h-[44px]">
                        Export Excel
                    </button>
                    <button onclick="showStockOrderModal()" class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg transition duration-200 text-sm min-h-[44px]">
                        Order Stok
                    </button>
                    <button onclick="showAddProductModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg transition duration-200 text-sm min-h-[44px]" id="addProductBtn">
                        Tambah Produk
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-4 md:p-6 border-b">
                    <div class="flex flex-col md:flex-row gap-3 md:gap-4">
                        <div class="flex-1">
                            <input type="text" id="searchProduct" placeholder="Cari produk berdasarkan nama atau kode..." class="form-control w-full" oninput="renderInventoryTable()">
                        </div>
                        <div class="md:w-48">
                            <select id="categoryFilter" class="form-control w-full" onchange="renderInventoryTable()">
                                <option value="">Semua Kategori</option>
                                <option value="Makanan">Makanan</option>
                                <option value="Minuman">Minuman</option>
                                <option value="Elektronik">Elektronik</option>
                                <option value="Pakaian">Pakaian</option>
                                <option value="Kesehatan & Kecantikan">Kesehatan & Kecantikan</option>
                                <option value="Peralatan Rumah Tangga">Peralatan Rumah Tangga</option>
                                <option value="Olahraga & Outdoor">Olahraga & Outdoor</option>
                                <option value="Buku & Alat Tulis">Buku & Alat Tulis</option>
                                <option value="Mainan & Hobi">Mainan & Hobi</option>
                                <option value="Otomotif">Otomotif</option>
                                <option value="Pertanian & Kebun">Pertanian & Kebun</option>
                                <option value="Lainnya">Lainnya</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama Produk</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga Beli</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga Jual</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stok</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryTable" class="bg-white divide-y divide-gray-200">
                            <!-- Products will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- POS Section -->
        <div id="posSection" class="section-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 md:gap-8">
                <!-- Product Selection -->
                <div class="lg:col-span-2 order-2 lg:order-1">
                    <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 md:mb-6 gap-3">
                            <h2 class="text-lg md:text-xl font-bold text-gray-900">Pilih Produk</h2>
                            <input type="text" id="posSearch" placeholder="Cari produk..." class="form-control w-full sm:w-auto" oninput="renderProductGrid()">
                        </div>
                        
                        <div id="productGrid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 xl:grid-cols-3 gap-3 md:gap-4">
                            <!-- Products will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Cart -->
                <div class="lg:col-span-1 order-1 lg:order-2">
                    <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 lg:sticky lg:top-8">
                        <div class="flex justify-between items-center mb-4 md:mb-6">
                            <h2 class="text-lg md:text-xl font-bold text-gray-900">Keranjang</h2>
                            <div class="text-xs text-gray-500" id="transactionDate"></div>
                        </div>
                        
                        <div id="cartItems" class="space-y-2 md:space-y-3 mb-4 md:mb-6 max-h-48 md:max-h-64 overflow-y-auto">
                            <p class="text-gray-500 text-center py-6 md:py-8 text-sm">Keranjang kosong</p>
                        </div>
                        
                        <div class="border-t pt-3 md:pt-4">
                            <div class="flex justify-between items-center mb-2 text-sm md:text-base">
                                <span class="text-gray-600">Subtotal:</span>
                                <span class="font-semibold" id="subtotal">Rp 0</span>
                            </div>
                            <div class="flex justify-between items-center mb-2 text-sm md:text-base">
                                <span class="text-gray-600">Pajak (10%):</span>
                                <span class="font-semibold" id="tax">Rp 0</span>
                            </div>
                            <div class="flex justify-between items-center mb-3 md:mb-4 text-base md:text-lg font-bold">
                                <span>Total:</span>
                                <span id="total">Rp 0</span>
                            </div>
                            
                            <div class="space-y-2 md:space-y-3">
                                <div class="flex items-center space-x-2 mb-2">
                                    <input type="checkbox" id="taxCheckbox" onchange="updateCartTotals()" class="rounded min-w-[20px] min-h-[20px]">
                                    <label for="taxCheckbox" class="text-sm text-gray-600">Kenakan Pajak (<span id="taxPercentageDisplay">10%</span>)</label>
                                </div>
                                <div>
                                    <label class="form-label text-xs">Tanggal Bayar</label>
                                    <input type="date" id="paymentDate" class="form-control w-full">
                                </div>
                                <select id="paymentMethod" class="form-control w-full">
                                    <option value="cash">Cash</option>
                                    <option value="transfer">Transfer</option>
                                </select>
                                <input type="number" id="paymentAmount" placeholder="Jumlah bayar" class="form-control w-full" oninput="calculateChange()">
                                <div class="flex justify-between items-center text-sm md:text-base">
                                    <span class="text-gray-600">Kembalian:</span>
                                    <span class="font-semibold" id="change">Rp 0</span>
                                </div>
                                <button onclick="processPayment()" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 text-sm md:text-base min-h-[48px]" disabled id="payButton">
                                    Proses Pembayaran
                                </button>
                                <button onclick="clearCart()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 text-sm md:text-base min-h-[44px]">
                                    Bersihkan Keranjang
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reports Section -->
        <div id="reportsSection" class="section-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 md:mb-6 gap-4">
                <h2 class="text-xl md:text-2xl font-bold text-gray-900">Laporan Sistem</h2>
                <div class="flex flex-col sm:flex-row gap-2">
                    <button onclick="exportSalesReport()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg transition duration-200 text-sm min-h-[44px]">
                        Export Laporan Penjualan
                    </button>
                    <button onclick="exportStockReport()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg transition duration-200 text-sm min-h-[44px]">
                        Export Laporan Stok
                    </button>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="p-6 border-b">
                    <h3 class="text-lg font-semibold text-gray-900">Riwayat Transaksi</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID Transaksi</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kasir</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="transactionHistory" class="bg-white divide-y divide-gray-200">
                            <!-- Transactions will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Database Section -->
        <div id="databaseSection" class="section-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 md:mb-6 gap-4">
                <h2 class="text-xl md:text-2xl font-bold text-gray-900">Database Produk</h2>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 w-full sm:w-auto">
                    <button onclick="exportDatabase()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg transition duration-200 text-sm min-h-[44px]">
                        Export Database
                    </button>
                    <button onclick="importDatabase()" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 md:px-4 md:py-2 rounded-lg transition duration-200 text-sm min-h-[44px]">
                        Import Database
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
                <!-- Form Input Produk -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Form Input Produk Baru</h3>
                    
                    <form id="productInputForm" class="space-y-4">
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="form-label">Nama Produk</label>
                                <input type="text" id="inputProductName" required class="form-control w-full" placeholder="Masukkan nama produk">
                            </div>
                            <div>
                                <label class="form-label">Kategori</label>
                                <select id="inputProductCategory" required class="form-control w-full">
                                    <option value="">Pilih Kategori</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="form-label">Harga Beli</label>
                                    <input type="number" id="inputBuyPrice" required class="form-control w-full" placeholder="0" min="0">
                                </div>
                                <div>
                                    <label class="form-label">Harga Jual</label>
                                    <input type="number" id="inputSellPrice" required class="form-control w-full" placeholder="0" min="0">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="form-label">Stok Awal</label>
                                    <input type="number" id="inputInitialStock" required class="form-control w-full" placeholder="0" min="0">
                                </div>
                                <div>
                                    <label class="form-label">Tanggal Stok Awal</label>
                                    <input type="date" id="inputStockDate" required class="form-control w-full">
                                </div>
                            </div>
                            <div>
                                <label class="form-label">Catatan</label>
                                <textarea id="inputProductNotes" class="form-control w-full" rows="3" placeholder="Catatan tambahan tentang produk (opsional)"></textarea>
                            </div>
                        </div>
                        
                        <div class="flex flex-col gap-3 pt-4">
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 min-h-[48px]">
                                Simpan Produk
                            </button>
                            <button type="button" onclick="resetProductForm()" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 min-h-[48px]">
                                Reset Form
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Daftar Produk -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Daftar Produk Database</h3>
                    
                    <!-- Filter Controls -->
                    <div class="space-y-3 mb-4">
                        <input type="text" id="databaseSearchProduct" placeholder="Cari produk berdasarkan nama atau kode..." class="form-control w-full" oninput="renderDatabaseProductTable()">
                        <select id="databaseCategoryFilter" class="form-control w-full" onchange="renderDatabaseProductTable()">
                            <option value="">Semua Kategori</option>
                        </select>
                    </div>
                    
                    <!-- Product Table -->
                    <div class="overflow-x-auto max-h-96 overflow-y-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50 sticky top-0">
                                <tr>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Kode</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nama</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Kategori</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Stok</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="databaseProductTable" class="bg-white divide-y divide-gray-200">
                                <!-- Products will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div id="settingsSection" class="section-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-8">
            <h2 class="text-xl md:text-2xl font-bold text-gray-900 mb-6">Pengaturan Sistem</h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8">
                <!-- Store Information Settings -->
                <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Informasi Toko</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">Nama Toko</label>
                            <input type="text" id="storeName" class="form-control w-full" placeholder="TOKO ABC">
                        </div>
                        <div>
                            <label class="form-label">Alamat Toko</label>
                            <textarea id="storeAddress" rows="2" class="form-control w-full" placeholder="Jl. Contoh No. 123"></textarea>
                        </div>
                        <div>
                            <label class="form-label">Nomor Telepon</label>
                            <input type="text" id="storePhone" class="form-control w-full" placeholder="021-12345678">
                        </div>
                        <button onclick="updateStoreInfo()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg min-h-[44px]">
                            Update Informasi Toko
                        </button>
                    </div>
                </div>

                <!-- Category Management -->
                <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Manajemen Kategori</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="form-label">Tambah Kategori Baru</label>
                            <div class="flex gap-2">
                                <input type="text" id="newCategoryName" class="form-control flex-1" placeholder="Nama kategori baru">
                                <button onclick="addNewCategory()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg min-h-[44px]">
                                    Tambah
                                </button>
                            </div>
                        </div>
                        <div>
                            <label class="form-label">Kategori Tersedia</label>
                            <div id="categoryList" class="space-y-2 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-gray-50">
                                <!-- Categories will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tax Settings -->
                <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Pengaturan Pajak</h3>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-3">
                            <input type="checkbox" id="taxEnabledSetting" onchange="updateTaxSettings()" class="rounded min-w-[20px] min-h-[20px]">
                            <label for="taxEnabledSetting" class="text-sm text-gray-700 font-medium">Aktifkan Pajak Otomatis</label>
                        </div>
                        <div>
                            <label class="form-label">Tarif Pajak (%)</label>
                            <input type="number" id="taxRateSetting" min="0" max="100" step="0.1" onchange="updateTaxSettings()" class="form-control w-full" placeholder="10">
                        </div>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 text-blue-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div class="text-xs text-blue-700">
                                    <p class="font-medium mb-1">Info Pajak</p>
                                    <p>Pengaturan ini akan mempengaruhi perhitungan pajak di Point of Sale. Tarif pajak saat ini: <span id="currentTaxRate">10%</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data Management -->
                <div class="bg-white rounded-xl shadow-lg p-4 md:p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Manajemen Data</h3>
                    <div class="space-y-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <div class="flex items-start">
                                <svg class="w-5 h-5 text-blue-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <div class="text-sm text-blue-700">
                                    <p class="font-medium mb-1">LocalStorage System!</p>
                                    <p>Data disimpan di browser dengan sistem backup/restore lengkap.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <div class="flex items-start">
                                <svg class="w-5 h-5 text-yellow-500 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                                <div class="text-sm text-yellow-700">
                                    <p class="font-medium mb-1">Peringatan!</p>
                                    <p>Backup data secara berkala. Reset akan menghapus semua data.</p>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <button onclick="backupData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg min-h-[44px]">
                                Backup Data
                            </button>
                            <button onclick="restoreData()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg min-h-[44px]">
                                Restore Data
                            </button>
                            <button onclick="downloadTemplate()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg min-h-[44px]">
                                Download Template
                            </button>
                            <button onclick="resetData()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg min-h-[44px]" id="resetDataBtn">
                                Reset Data
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="productDetailModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-overlay hidden items-center justify-center z-50 p-2 sm:p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-auto max-h-[95vh] overflow-y-auto modal-content">
            <div class="sticky top-0 bg-white rounded-t-xl border-b border-gray-200 px-4 sm:px-6 py-4 z-10">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-900">Detail Produk</h3>
                    <button onclick="closeProductDetailModal()" class="text-gray-400 hover:text-gray-600 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="px-4 sm:px-6 py-4" id="productDetailContent">
                <!-- Product detail content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Transaction Detail Modal -->
    <div id="transactionDetailModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-overlay hidden items-center justify-center z-50 p-2 sm:p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl mx-auto max-h-[95vh] overflow-y-auto modal-content">
            <div class="sticky top-0 bg-white rounded-t-xl border-b border-gray-200 px-4 sm:px-6 py-4 z-10">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-900">Detail Transaksi</h3>
                    <button onclick="closeTransactionDetailModal()" class="text-gray-400 hover:text-gray-600 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="px-4 sm:px-6 py-4" id="transactionDetailContent">
                <!-- Transaction detail content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Stock Order Modal -->
    <div id="stockOrderModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-overlay hidden items-center justify-center z-50 p-2 sm:p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl mx-auto max-h-[95vh] overflow-y-auto modal-content">
            <div class="sticky top-0 bg-white rounded-t-xl border-b border-gray-200 px-4 sm:px-6 py-4 z-10">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-900">Order Stok Produk</h3>
                    <button onclick="closeStockOrderModal()" class="text-gray-400 hover:text-gray-600 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="px-4 sm:px-6 py-4">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Product Selection -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">Pilih Produk untuk Order</h4>
                        <div class="mb-4">
                            <input type="text" id="stockOrderSearch" placeholder="Cari produk..." class="form-control w-full" oninput="renderStockOrderProducts()">
                        </div>
                        <div id="stockOrderProducts" class="space-y-2 max-h-96 overflow-y-auto border border-gray-200 rounded-lg p-3">
                            <!-- Products will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Order Cart -->
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">Daftar Order</h4>
                        <div id="stockOrderCart" class="space-y-2 mb-4 max-h-96 overflow-y-auto border border-gray-200 rounded-lg p-3">
                            <p class="text-gray-500 text-center py-8">Belum ada produk yang dipilih</p>
                        </div>
                        <div class="space-y-3">
                            <div>
                                <label class="form-label">Tanggal Order</label>
                                <input type="date" id="stockOrderDate" class="form-control w-full" required>
                            </div>
                            <div>
                                <label class="form-label">Catatan Order</label>
                                <textarea id="stockOrderNotes" class="form-control w-full" rows="3" placeholder="Catatan tambahan untuk order ini"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="sticky bottom-0 bg-white rounded-b-xl border-t border-gray-200 px-4 sm:px-6 py-4">
                <div class="flex flex-col sm:flex-row gap-3">
                    <button onclick="submitStockOrder()" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 text-sm sm:text-base min-h-[48px]" id="submitOrderBtn" disabled>
                        Submit Order
                    </button>
                    <button onclick="closeStockOrderModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 text-sm sm:text-base min-h-[48px]">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Receive Modal -->
    <div id="stockReceiveModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-overlay hidden items-center justify-center z-50 p-2 sm:p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-auto max-h-[95vh] overflow-y-auto modal-content">
            <div class="sticky top-0 bg-white rounded-t-xl border-b border-gray-200 px-4 sm:px-6 py-4 z-10">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-900">Penerimaan Stok</h3>
                    <button onclick="closeStockReceiveModal()" class="text-gray-400 hover:text-gray-600 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="px-4 sm:px-6 py-4" id="stockReceiveContent">
                <!-- Content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 modal-overlay hidden items-center justify-center z-50 p-2 sm:p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-auto max-h-[95vh] overflow-y-auto modal-content">
            <div class="sticky top-0 bg-white rounded-t-xl border-b border-gray-200 px-4 sm:px-6 py-4 z-10">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg sm:text-xl font-bold text-gray-900">Tambah Produk Baru</h3>
                    <button onclick="closeAddProductModal()" class="text-gray-400 hover:text-gray-600 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="px-4 sm:px-6 py-4">
                <form id="addProductForm" class="space-y-4">
                    <div>
                        <label class="form-label">Nama Produk</label>
                        <input type="text" id="productName" required class="form-control w-full" placeholder="Masukkan nama produk">
                    </div>
                    <div>
                        <label class="form-label">Kategori</label>
                        <select id="productCategory" required class="form-control w-full">
                            <option value="">Pilih Kategori</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Harga Beli</label>
                        <input type="number" id="productBuyPrice" required class="form-control w-full" placeholder="0" min="0">
                    </div>
                    <div>
                        <label class="form-label">Harga Jual</label>
                        <input type="number" id="productSellPrice" required class="form-control w-full" placeholder="0" min="0">
                    </div>
                    <div>
                        <label class="form-label">Stok Awal</label>
                        <input type="number" id="productStock" required class="form-control w-full" placeholder="0" min="0">
                    </div>
                    <div>
                        <label class="form-label">Tanggal Pembelian</label>
                        <input type="date" id="productPurchaseDate" required class="form-control w-full">
                    </div>
                    <div>
                        <label class="form-label">Catatan</label>
                        <textarea id="productNotes" class="form-control w-full" rows="3" placeholder="Catatan tambahan tentang produk (opsional)"></textarea>
                    </div>
                </form>
            </div>
            
            <div class="sticky bottom-0 bg-white rounded-b-xl border-t border-gray-200 px-4 sm:px-6 py-4">
                <div class="flex flex-col sm:flex-row gap-3">
                    <button type="submit" form="addProductForm" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 text-sm sm:text-base min-h-[48px]">
                        Tambah Produk
                    </button>
                    <button type="button" onclick="closeAddProductModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 text-sm sm:text-base min-h-[48px]">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let userRole = null;
        let products = [];
        let cart = [];
        let transactions = [];
        let users = [];
        let categories = [];
        let stockOrders = [];
        let pendingOrders = [];
        let stockOrderCart = [];
        let productCodePrefix = 'P';
        let taxEnabled = true;
        let taxPercentage = 10;
        let storeInfo = {
            name: 'TOKO ABC',
            address: 'Jl. Contoh No. 123',
            phone: '021-12345678',
            email: '',
            footer: 'Terima kasih atas kunjungan Anda!'
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - Initializing app...');
            
            try {
                loadData();
                initializeApp();
                
                // Set today's date for date inputs
                const today = new Date().toISOString().split('T')[0];
                const purchaseDateInput = document.getElementById('productPurchaseDate');
                const stockDateInput = document.getElementById('inputStockDate');
                const paymentDateInput = document.getElementById('paymentDate');
                
                if (purchaseDateInput) purchaseDateInput.value = today;
                if (stockDateInput) stockDateInput.value = today;
                if (paymentDateInput) paymentDateInput.value = today;
                
                // Update transaction date display
                updateTransactionDate();
                
                console.log('App initialized successfully');
            } catch (error) {
                console.error('Error initializing app:', error);
                alert('Error initializing application. Please refresh the page.');
            }
        });

        // Data management functions
        function loadData() {
            try {
                // Load products
                const savedProducts = localStorage.getItem('pos_products');
                if (savedProducts) {
                    products = JSON.parse(savedProducts);
                }

                // Load transactions
                const savedTransactions = localStorage.getItem('pos_transactions');
                if (savedTransactions) {
                    transactions = JSON.parse(savedTransactions);
                }

                // Load stock orders
                const savedStockOrders = localStorage.getItem('pos_stockOrders');
                if (savedStockOrders) {
                    stockOrders = JSON.parse(savedStockOrders);
                }

                // Load pending orders
                const savedPendingOrders = localStorage.getItem('pos_pendingOrders');
                if (savedPendingOrders) {
                    pendingOrders = JSON.parse(savedPendingOrders);
                }

                // Load users
                const savedUsers = localStorage.getItem('pos_users');
                if (savedUsers) {
                    users = JSON.parse(savedUsers);
                } else {
                    // Initialize default users
                    users = [
                        { username: 'admin', password: 'admin123', role: 'admin' },
                        { username: 'kasir', password: 'kasir123', role: 'kasir' }
                    ];
                    saveData();
                }

                // Load categories
                const savedCategories = localStorage.getItem('pos_categories');
                if (savedCategories) {
                    categories = JSON.parse(savedCategories);
                } else {
                    // Initialize default categories
                    categories = [
                        'Makanan', 'Minuman', 'Elektronik', 'Pakaian', 'Kesehatan & Kecantikan',
                        'Peralatan Rumah Tangga', 'Olahraga & Outdoor', 'Buku & Alat Tulis',
                        'Mainan & Hobi', 'Otomotif', 'Pertanian & Kebun', 'Lainnya'
                    ];
                    saveData();
                }

                // Load settings
                const savedSettings = localStorage.getItem('pos_settings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    productCodePrefix = settings.productCodePrefix || 'P';
                    taxEnabled = settings.taxEnabled !== undefined ? settings.taxEnabled : true;
                    taxPercentage = settings.taxPercentage || 10;
                    storeInfo = { ...storeInfo, ...settings.storeInfo };
                }

                console.log('Data loaded successfully');
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error loading data. Starting with fresh data.');
            }
        }

        function saveData() {
            try {
                localStorage.setItem('pos_products', JSON.stringify(products));
                localStorage.setItem('pos_transactions', JSON.stringify(transactions));
                localStorage.setItem('pos_users', JSON.stringify(users));
                localStorage.setItem('pos_categories', JSON.stringify(categories));
                localStorage.setItem('pos_stockOrders', JSON.stringify(stockOrders));
                localStorage.setItem('pos_pendingOrders', JSON.stringify(pendingOrders));
                
                const settings = {
                    productCodePrefix,
                    taxEnabled,
                    taxPercentage,
                    storeInfo
                };
                localStorage.setItem('pos_settings', JSON.stringify(settings));
                
                console.log('Data saved successfully');
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error saving data. Please try again.');
            }
        }

        function initializeApp() {
            // Setup login form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }

            // Setup add product form
            const addProductForm = document.getElementById('addProductForm');
            if (addProductForm) {
                addProductForm.addEventListener('submit', handleAddProduct);
            }

            // Setup product input form
            const productInputForm = document.getElementById('productInputForm');
            if (productInputForm) {
                productInputForm.addEventListener('submit', handleProductInput);
            }

            // Populate category dropdowns
            populateCategoryDropdowns();
            
            // Load store info into settings
            loadStoreInfoToSettings();
        }

        // Login functionality
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user.username;
                userRole = user.role;
                
                // Hide login screen and show main app
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                // Update user info in header
                document.getElementById('currentUser').textContent = `Selamat datang, ${currentUser}`;
                document.getElementById('userRole').textContent = `${user.role === 'admin' ? 'Admin' : 'Kasir'} Dashboard`;
                
                // Setup role-based access
                setupRoleBasedAccess();
                
                // Initialize all sections and data
                initializeAfterLogin();
                
                console.log('Login successful:', currentUser, userRole);
            } else {
                alert('Username atau password salah!');
            }
        }

        function initializeAfterLogin() {
            // Initialize dashboard
            updateDashboard();
            
            // Initialize inventory
            renderInventoryTable();
            
            // Initialize POS
            renderProductGrid();
            updateTransactionDate();
            
            // Set payment date to today
            const today = new Date().toISOString().split('T')[0];
            const paymentDateInput = document.getElementById('paymentDate');
            if (paymentDateInput) paymentDateInput.value = today;
            
            // Initialize reports
            renderTransactionHistory();
            
            // Initialize database section
            populateCategoryDropdowns();
            
            // Initialize settings
            loadStoreInfoToSettings();
            loadTaxSettings();
            
            // Show dashboard by default
            showSection('dashboard');
        }

        function setupRoleBasedAccess() {
            if (userRole === 'kasir') {
                // Kasir can see all menus but with limited actions
                // Hide reset data button in settings
                setTimeout(() => {
                    const resetButton = document.getElementById('resetDataBtn');
                    if (resetButton) resetButton.style.display = 'none';
                }, 500);
            } else {
                // Admin has full access - show all features
                setTimeout(() => {
                    const resetButton = document.getElementById('resetDataBtn');
                    if (resetButton) resetButton.style.display = '';
                }, 500);
            }
        }

        function logout() {
            currentUser = null;
            userRole = null;
            cart = [];
            
            // Clear forms
            document.getElementById('loginForm').reset();
            
            // Show login screen and hide main app
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            
            // Reset navigation
            showSection('dashboard');
        }

        // Navigation functionality
        function showSection(sectionName) {
            // Check if user is logged in
            if (!currentUser) {
                console.log('User not logged in, cannot show section');
                return;
            }
            
            // Hide all sections
            const sections = document.querySelectorAll('.section-content');
            sections.forEach(section => {
                section.classList.remove('active');
                section.style.display = 'none';
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.classList.add('active');
                targetSection.style.display = 'block';
            }
            
            // Update navigation buttons
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => {
                btn.classList.remove('active');
                btn.style.color = '#6b7280';
                btn.style.borderBottomColor = 'transparent';
            });
            
            // Activate current nav button
            const activeButtons = document.querySelectorAll(`[onclick="showSection('${sectionName}')"]`);
            activeButtons.forEach(btn => {
                btn.classList.add('active');
                btn.style.color = '#3b82f6';
                btn.style.borderBottomColor = '#3b82f6';
            });
            
            // Close mobile nav
            const mobileNav = document.getElementById('mobileNav');
            if (mobileNav) {
                mobileNav.classList.add('hidden');
            }
            
            // Update section-specific data
            setTimeout(() => {
                if (sectionName === 'dashboard') {
                    updateDashboard();
                } else if (sectionName === 'inventory') {
                    renderInventoryTable();
                } else if (sectionName === 'pos') {
                    renderProductGrid();
                    updateTransactionDate();
                } else if (sectionName === 'reports') {
                    renderTransactionHistory();
                } else if (sectionName === 'database') {
                    populateCategoryDropdowns();
                    renderDatabaseProductTable();
                } else if (sectionName === 'settings') {
                    loadStoreInfoToSettings();
                }
            }, 100);
            
            console.log('Showing section:', sectionName);
        }

        function toggleMobileNav() {
            const mobileNav = document.getElementById('mobileNav');
            if (mobileNav) {
                mobileNav.classList.toggle('hidden');
            }
        }

        // Dashboard functionality
        function updateDashboard() {
            // Update statistics
            document.getElementById('totalProducts').textContent = products.length;
            
            // Calculate today's sales
            const today = new Date().toDateString();
            const todayTransactions = transactions.filter(t => new Date(t.date).toDateString() === today);
            const todayTotal = todayTransactions.reduce((sum, t) => sum + t.total, 0);
            document.getElementById('todaySales').textContent = formatCurrency(todayTotal);
            
            // Calculate low stock items
            const lowStockItems = products.filter(p => p.stock <= 5);
            document.getElementById('lowStock').textContent = lowStockItems.length;
            
            // Total transactions
            document.getElementById('totalTransactions').textContent = transactions.length;
            
            // Update top products
            updateTopProducts();
            
            // Update recent activity
            updateRecentActivity();
        }

        function updateTopProducts() {
            const topProductsContainer = document.getElementById('topProducts');
            if (!topProductsContainer) return;
            
            if (transactions.length === 0) {
                topProductsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada data penjualan</p>';
                return;
            }
            
            // Calculate product sales
            const productSales = {};
            transactions.forEach(transaction => {
                transaction.items.forEach(item => {
                    if (productSales[item.id]) {
                        productSales[item.id].quantity += item.quantity;
                        productSales[item.id].total += item.quantity * item.price;
                    } else {
                        productSales[item.id] = {
                            name: item.name,
                            quantity: item.quantity,
                            total: item.quantity * item.price
                        };
                    }
                });
            });
            
            // Sort by quantity sold
            const sortedProducts = Object.entries(productSales)
                .sort(([,a], [,b]) => b.quantity - a.quantity)
                .slice(0, 5);
            
            if (sortedProducts.length === 0) {
                topProductsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada data penjualan</p>';
                return;
            }
            
            topProductsContainer.innerHTML = sortedProducts.map(([id, data]) => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                        <p class="font-medium text-gray-900">${data.name}</p>
                        <p class="text-sm text-gray-600">${data.quantity} terjual</p>
                    </div>
                    <p class="font-semibold text-green-600">${formatCurrency(data.total)}</p>
                </div>
            `).join('');
        }

        function updateRecentActivity() {
            const recentActivityContainer = document.getElementById('recentActivity');
            if (!recentActivityContainer) return;
            
            if (transactions.length === 0) {
                recentActivityContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada aktivitas</p>';
                return;
            }
            
            const recentTransactions = transactions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5);
            
            recentActivityContainer.innerHTML = recentTransactions.map(transaction => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div>
                        <p class="font-medium text-gray-900">Transaksi #${transaction.id}</p>
                        <p class="text-sm text-gray-600">${formatDate(transaction.date)}</p>
                    </div>
                    <p class="font-semibold text-blue-600">${formatCurrency(transaction.total)}</p>
                </div>
            `).join('');
        }

        // Product management
        function generateProductCode() {
            const existingCodes = products.map(p => p.code);
            let counter = 1;
            let newCode;
            
            do {
                newCode = productCodePrefix + counter.toString().padStart(3, '0');
                counter++;
            } while (existingCodes.includes(newCode));
            
            return newCode;
        }

        function handleAddProduct(e) {
            e.preventDefault();
            
            const name = document.getElementById('productName').value;
            const category = document.getElementById('productCategory').value;
            const buyPrice = parseFloat(document.getElementById('productBuyPrice').value);
            const sellPrice = parseFloat(document.getElementById('productSellPrice').value);
            const stock = parseInt(document.getElementById('productStock').value);
            const purchaseDate = document.getElementById('productPurchaseDate').value;
            const notes = document.getElementById('productNotes').value.trim();
            
            const newProduct = {
                id: Date.now().toString(),
                code: generateProductCode(),
                name,
                category,
                buyPrice,
                sellPrice,
                stock,
                purchaseDate,
                notes: notes || '',
                createdAt: new Date().toISOString()
            };
            
            products.push(newProduct);
            saveData();
            
            // Reset form and close modal
            document.getElementById('addProductForm').reset();
            closeAddProductModal();
            
            // Refresh displays
            renderInventoryTable();
            renderProductGrid();
            renderDatabaseProductTable();
            updateDashboard();
            
            alert('Produk berhasil ditambahkan!');
        }

        function handleProductInput(e) {
            e.preventDefault();
            
            const name = document.getElementById('inputProductName').value;
            const category = document.getElementById('inputProductCategory').value;
            const buyPrice = parseFloat(document.getElementById('inputBuyPrice').value);
            const sellPrice = parseFloat(document.getElementById('inputSellPrice').value) || 0;
            const stock = parseInt(document.getElementById('inputInitialStock').value);
            const stockDate = document.getElementById('inputStockDate').value;
            const notes = document.getElementById('inputProductNotes').value.trim();
            
            const newProduct = {
                id: Date.now().toString(),
                code: generateProductCode(),
                name,
                category,
                buyPrice,
                sellPrice,
                stock,
                purchaseDate: stockDate,
                notes: notes || '',
                createdAt: new Date().toISOString()
            };
            
            products.push(newProduct);
            saveData();
            
            // Reset form
            resetProductForm();
            
            // Refresh displays
            renderInventoryTable();
            renderProductGrid();
            renderDatabaseProductTable();
            updateDashboard();
            
            alert('Produk berhasil ditambahkan ke database!');
        }

        function resetProductForm() {
            const form = document.getElementById('productInputForm');
            if (form) {
                form.reset();
                const today = new Date().toISOString().split('T')[0];
                const stockDateInput = document.getElementById('inputStockDate');
                if (stockDateInput) stockDateInput.value = today;
            }
        }

        // Inventory table rendering
        function renderInventoryTable() {
            const tableBody = document.getElementById('inventoryTable');
            if (!tableBody) return;
            
            const searchTerm = document.getElementById('searchProduct')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('categoryFilter')?.value || '';
            
            let filteredProducts = products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                    product.code.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || product.category === categoryFilter;
                return matchesSearch && matchesCategory;
            });
            
            if (filteredProducts.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-6 py-4 text-center text-gray-500">
                            ${products.length === 0 ? 'Belum ada produk' : 'Tidak ada produk yang sesuai filter'}
                        </td>
                    </tr>
                `;
                return;
            }
            
            tableBody.innerHTML = filteredProducts.map(product => {
                const margin = product.sellPrice > 0 ? ((product.sellPrice - product.buyPrice) / product.buyPrice * 100).toFixed(1) : 0;
                const stockStatus = product.stock <= 5 ? 'Stok Menipis' : product.stock <= 10 ? 'Stok Sedang' : 'Stok Aman';
                const stockClass = product.stock <= 5 ? 'text-red-600 bg-red-100' : product.stock <= 10 ? 'text-yellow-600 bg-yellow-100' : 'text-green-600 bg-green-100';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${product.code}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">${product.name}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-500">${product.category}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(product.buyPrice)}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">${product.sellPrice > 0 ? formatCurrency(product.sellPrice) : '-'}</td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm text-gray-900">${product.stock}</td>
                        <td class="px-3 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${stockClass}">
                                ${stockStatus}
                            </span>
                        </td>
                        <td class="px-3 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <button onclick="showProductDetail('${product.id}')" class="text-green-600 hover:text-green-900">Detail</button>
                                <button onclick="editProduct('${product.id}')" class="text-blue-600 hover:text-blue-900">Edit</button>
                                <button onclick="deleteProduct('${product.id}')" class="text-red-600 hover:text-red-900 ${userRole === 'kasir' ? 'hidden' : ''}">Hapus</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function showProductDetail(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // Calculate profit margin and sales data
            const profitMargin = product.sellPrice > 0 ? ((product.sellPrice - product.buyPrice) / product.buyPrice * 100).toFixed(1) : 0;
            const profitPerUnit = product.sellPrice > 0 ? product.sellPrice - product.buyPrice : 0;
            
            // Calculate sales data from transactions
            let totalSold = 0;
            let totalRevenue = 0;
            let totalProfit = 0;
            
            transactions.forEach(transaction => {
                const item = transaction.items.find(item => item.id === productId);
                if (item) {
                    totalSold += item.quantity;
                    totalRevenue += item.quantity * item.price;
                    totalProfit += item.quantity * (item.price - product.buyPrice);
                }
            });
            
            const stockValue = product.stock * product.buyPrice;
            const potentialRevenue = product.stock * product.sellPrice;
            const potentialProfit = product.stock * profitPerUnit;
            
            const detailContent = document.getElementById('productDetailContent');
            detailContent.innerHTML = `
                <div class="space-y-6">
                    <!-- Product Info Card -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-xl font-bold text-gray-900">${product.name}</h4>
                            <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">${product.code}</span>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-600">Kategori</p>
                                <p class="font-semibold text-gray-900">${product.category}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Tanggal Input</p>
                                <p class="font-semibold text-gray-900">${formatDate(product.purchaseDate)}</p>
                            </div>
                        </div>
                        ${product.notes ? `
                            <div class="mt-4 p-3 bg-gray-50 rounded-lg border">
                                <p class="text-sm text-gray-600 mb-1">Catatan:</p>
                                <p class="text-sm text-gray-900">${product.notes}</p>
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- Price Information -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                            <div class="flex items-center">
                                <div class="bg-green-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Harga Beli</p>
                                    <p class="text-lg font-bold text-green-600">${formatCurrency(product.buyPrice)}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4 border border-blue-200">
                            <div class="flex items-center">
                                <div class="bg-blue-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Harga Jual</p>
                                    <p class="text-lg font-bold text-blue-600">${product.sellPrice > 0 ? formatCurrency(product.sellPrice) : 'Belum diset'}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                            <div class="flex items-center">
                                <div class="bg-purple-100 p-2 rounded-full mr-3">
                                    <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Margin Keuntungan</p>
                                    <p class="text-lg font-bold text-purple-600">${profitMargin}%</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stock Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <h5 class="font-semibold text-gray-900 mb-4">Informasi Stok</h5>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Stok Tersedia:</span>
                                    <span class="font-semibold ${product.stock <= 5 ? 'text-red-600' : product.stock <= 10 ? 'text-yellow-600' : 'text-green-600'}">${product.stock} unit</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Nilai Stok (Beli):</span>
                                    <span class="font-semibold text-gray-900">${formatCurrency(stockValue)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Potensi Pendapatan:</span>
                                    <span class="font-semibold text-blue-600">${formatCurrency(potentialRevenue)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Potensi Keuntungan:</span>
                                    <span class="font-semibold text-green-600">${formatCurrency(potentialProfit)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <h5 class="font-semibold text-gray-900 mb-4">Data Penjualan</h5>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Terjual:</span>
                                    <span class="font-semibold text-gray-900">${totalSold} unit</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Pendapatan:</span>
                                    <span class="font-semibold text-blue-600">${formatCurrency(totalRevenue)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Keuntungan:</span>
                                    <span class="font-semibold text-green-600">${formatCurrency(totalProfit)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Keuntungan per Unit:</span>
                                    <span class="font-semibold text-purple-600">${formatCurrency(profitPerUnit)}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Status Badge -->
                    <div class="flex justify-center">
                        <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium ${
                            product.stock <= 5 ? 'bg-red-100 text-red-800' : 
                            product.stock <= 10 ? 'bg-yellow-100 text-yellow-800' : 
                            'bg-green-100 text-green-800'
                        }">
                            ${product.stock <= 5 ? ' Stok Menipis' : product.stock <= 10 ? ' Stok Sedang' : ' Stok Aman'}
                        </span>
                    </div>
                </div>
            `;
            
            // Show modal
            const modal = document.getElementById('productDetailModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.classList.add('modal-open');
            }
        }

        function closeProductDetailModal() {
            const modal = document.getElementById('productDetailModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.classList.remove('modal-open');
            }
        }

        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            // For now, just show an alert. In a full implementation, you'd open an edit modal
            alert(`Edit produk: ${product.name}\n\nFitur edit akan ditambahkan di versi selanjutnya.`);
        }

        function deleteProduct(productId) {
            if (userRole === 'kasir') {
                alert('Akses ditolak! Kasir tidak memiliki izin untuk menghapus produk.');
                return;
            }
            
            if (!confirm('Apakah Anda yakin ingin menghapus produk ini?')) return;
            
            products = products.filter(p => p.id !== productId);
            saveData();
            
            renderInventoryTable();
            renderProductGrid();
            renderDatabaseProductTable();
            updateDashboard();
            
            alert('Produk berhasil dihapus!');
        }

        // POS functionality
        function renderProductGrid() {
            const productGrid = document.getElementById('productGrid');
            if (!productGrid) return;
            
            const searchTerm = document.getElementById('posSearch')?.value.toLowerCase() || '';
            
            let filteredProducts = products.filter(product => {
                return product.name.toLowerCase().includes(searchTerm) && 
                       product.stock > 0 && 
                       product.sellPrice > 0;
            });
            
            if (filteredProducts.length === 0) {
                productGrid.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        ${products.length === 0 ? 'Belum ada produk' : 'Tidak ada produk yang tersedia'}
                    </div>
                `;
                return;
            }
            
            productGrid.innerHTML = filteredProducts.map(product => `
                <div class="bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow cursor-pointer" onclick="addToCart('${product.id}')">
                    <h3 class="font-semibold text-gray-900 mb-2">${product.name}</h3>
                    <p class="text-sm text-gray-600 mb-1">${product.category}</p>
                    <p class="text-sm text-gray-600 mb-2">Stok: ${product.stock}</p>
                    <p class="text-lg font-bold text-blue-600">${formatCurrency(product.sellPrice)}</p>
                </div>
            `).join('');
        }

        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product || product.stock <= 0) {
                alert('Produk tidak tersedia atau stok habis!');
                return;
            }
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                if (existingItem.quantity >= product.stock) {
                    alert('Stok tidak mencukupi!');
                    return;
                }
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: product.name,
                    price: product.sellPrice,
                    quantity: 1,
                    stock: product.stock
                });
            }
            
            renderCart();
            updateCartTotals();
        }

        function renderCart() {
            const cartItems = document.getElementById('cartItems');
            if (!cartItems) return;
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-gray-500 text-center py-6 md:py-8 text-sm">Keranjang kosong</p>';
                return;
            }
            
            cartItems.innerHTML = cart.map(item => `
                <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex-1">
                            <p class="font-semibold text-gray-900 text-sm mb-1">${item.name}</p>
                            <p class="text-xs text-blue-600 font-medium">${formatCurrency(item.price)} per unit</p>
                            <p class="text-xs text-gray-500 mt-1"> Stok tersedia: ${item.stock} unit</p>
                        </div>
                        <button onclick="removeFromCart('${item.id}')" class="w-7 h-7 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center text-sm font-bold ml-2 transition-colors"></button>
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-2">
                            <button onclick="updateCartQuantity('${item.id}', ${item.quantity - 1})" 
                                    class="w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-lg flex items-center justify-center text-sm font-bold transition-colors ${item.quantity <= 1 ? 'opacity-50 cursor-not-allowed' : ''}" 
                                    ${item.quantity <= 1 ? 'disabled' : ''}></button>
                            
                            <div class="relative">
                                <input type="number" 
                                       value="${item.quantity}" 
                                       min="1" 
                                       max="${item.stock}" 
                                       onchange="updateCartQuantityManual('${item.id}', this.value)" 
                                       onkeypress="if(event.key==='Enter') this.blur()"
                                       onclick="this.select()"
                                       class="w-16 h-8 text-center text-sm font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all bg-white">
                                <div class="absolute -bottom-5 left-0 right-0 text-xs text-gray-400 text-center">qty</div>
                            </div>
                            
                            <button onclick="updateCartQuantity('${item.id}', ${item.quantity + 1})" 
                                    class="w-8 h-8 bg-green-500 hover:bg-green-600 text-white rounded-lg flex items-center justify-center text-sm font-bold transition-colors ${item.quantity >= item.stock ? 'opacity-50 cursor-not-allowed' : ''}" 
                                    ${item.quantity >= item.stock ? 'disabled' : ''}>+</button>
                        </div>
                        
                        <div class="text-right">
                            <p class="text-sm font-bold text-gray-900 mb-1">${formatCurrency(item.price * item.quantity)}</p>
                            <p class="text-xs text-gray-500">${item.quantity}  ${formatCurrency(item.price)}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateCartQuantity(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromCart(productId);
                return;
            }
            
            const product = products.find(p => p.id === productId);
            if (!product) {
                alert(' Produk tidak ditemukan!');
                return;
            }
            
            if (newQuantity > product.stock) {
                alert(` Stok tidak mencukupi!\n\nMaksimal tersedia: ${product.stock} unit`);
                return;
            }
            
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem) {
                cartItem.quantity = newQuantity;
                renderCart();
                updateCartTotals();
            }
        }

        function updateCartQuantityManual(productId, newQuantity) {
            const quantity = parseInt(newQuantity);
            
            // Validate input
            if (isNaN(quantity) || quantity <= 0) {
                alert(' Quantity harus berupa angka positif!');
                renderCart(); // Reset display
                return;
            }
            
            const product = products.find(p => p.id === productId);
            if (!product) {
                alert(' Produk tidak ditemukan!');
                renderCart();
                return;
            }
            
            if (quantity > product.stock) {
                alert(` Stok tidak mencukupi!\n\nMaksimal tersedia: ${product.stock} unit\nAnda input: ${quantity} unit`);
                renderCart(); // Reset display
                return;
            }
            
            const cartItem = cart.find(item => item.id === productId);
            if (cartItem) {
                const oldQuantity = cartItem.quantity;
                cartItem.quantity = quantity;
                
                // Show success feedback for significant changes
                if (Math.abs(quantity - oldQuantity) > 1) {
                    console.log(` Quantity ${product.name} diubah dari ${oldQuantity} ke ${quantity} unit`);
                }
                
                renderCart();
                updateCartTotals();
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            renderCart();
            updateCartTotals();
        }

        function clearCart() {
            cart = [];
            renderCart();
            updateCartTotals();
        }

        function updateCartTotals() {
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const taxCheckbox = document.getElementById('taxCheckbox');
            const taxAmount = taxCheckbox && taxCheckbox.checked ? subtotal * (taxPercentage / 100) : 0;
            const total = subtotal + taxAmount;
            
            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('tax').textContent = formatCurrency(taxAmount);
            document.getElementById('total').textContent = formatCurrency(total);
            
            // Enable/disable pay button
            const payButton = document.getElementById('payButton');
            if (payButton) {
                payButton.disabled = cart.length === 0;
            }
            
            calculateChange();
        }

        function calculateChange() {
            const total = parseFloat(document.getElementById('total').textContent.replace(/[^\d]/g, '')) || 0;
            const paymentAmount = parseFloat(document.getElementById('paymentAmount').value) || 0;
            const change = paymentAmount - total;
            
            document.getElementById('change').textContent = formatCurrency(Math.max(0, change));
            
            // Enable/disable pay button based on payment amount
            const payButton = document.getElementById('payButton');
            if (payButton) {
                payButton.disabled = cart.length === 0 || paymentAmount < total;
            }
        }

        function processPayment() {
            if (cart.length === 0) {
                alert('Keranjang kosong!');
                return;
            }
            
            const total = parseFloat(document.getElementById('total').textContent.replace(/[^\d]/g, ''));
            const paymentAmount = parseFloat(document.getElementById('paymentAmount').value) || 0;
            const paymentDate = document.getElementById('paymentDate').value;
            
            if (paymentAmount < total) {
                alert('Jumlah pembayaran kurang!');
                return;
            }
            
            if (!paymentDate) {
                alert('Tanggal bayar harus dipilih!');
                return;
            }
            
            // Create transaction
            const transaction = {
                id: 'TRX' + Date.now(),
                date: new Date(paymentDate + 'T' + new Date().toTimeString().split(' ')[0]).toISOString(),
                items: [...cart],
                subtotal: parseFloat(document.getElementById('subtotal').textContent.replace(/[^\d]/g, '')),
                tax: parseFloat(document.getElementById('tax').textContent.replace(/[^\d]/g, '')),
                total: total,
                paymentMethod: document.getElementById('paymentMethod').value,
                paymentAmount: paymentAmount,
                change: paymentAmount - total,
                cashier: currentUser
            };
            
            // Update product stock
            cart.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    product.stock -= item.quantity;
                }
            });
            
            // Save transaction
            transactions.push(transaction);
            saveData();
            
            // Show receipt
            showReceipt(transaction);
            
            // Clear cart and reset form
            clearCart();
            document.getElementById('paymentAmount').value = '';
            
            // Reset payment date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('paymentDate').value = today;
            
            // Update displays
            renderProductGrid();
            updateDashboard();
            
            alert('Pembayaran berhasil diproses!');
        }

        function showReceipt(transaction) {
            printReceipt(transaction);
        }

        function printReceipt(transaction) {
            const receiptWindow = window.open('', '_blank', 'width=300,height=600');
            const receiptContent = generateReceiptHTML(transaction);
            
            receiptWindow.document.write(receiptContent);
            receiptWindow.document.close();
            
            // Auto print after a short delay
            setTimeout(() => {
                receiptWindow.print();
                receiptWindow.close();
            }, 500);
        }

        function generateReceiptHTML(transaction) {
            const receiptDate = new Date(transaction.date).toLocaleString('id-ID');
            
            return `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Struk Pembayaran</title>
                    <style>
                        body {
                            font-family: 'Courier New', monospace;
                            font-size: 12px;
                            line-height: 1.4;
                            margin: 0;
                            padding: 10px;
                            width: 280px;
                        }
                        .header {
                            text-align: center;
                            border-bottom: 1px dashed #000;
                            padding-bottom: 10px;
                            margin-bottom: 10px;
                        }
                        .store-name {
                            font-size: 16px;
                            font-weight: bold;
                            margin-bottom: 5px;
                        }
                        .store-info {
                            font-size: 10px;
                            margin-bottom: 2px;
                        }
                        .transaction-info {
                            margin-bottom: 10px;
                            font-size: 10px;
                        }
                        .items {
                            border-bottom: 1px dashed #000;
                            padding-bottom: 10px;
                            margin-bottom: 10px;
                        }
                        .item {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 3px;
                        }
                        .item-name {
                            flex: 1;
                        }
                        .item-qty {
                            width: 30px;
                            text-align: center;
                        }
                        .item-price {
                            width: 60px;
                            text-align: right;
                        }
                        .totals {
                            border-bottom: 1px dashed #000;
                            padding-bottom: 10px;
                            margin-bottom: 10px;
                        }
                        .total-line {
                            display: flex;
                            justify-content: space-between;
                            margin-bottom: 3px;
                        }
                        .total-line.grand-total {
                            font-weight: bold;
                            font-size: 14px;
                            border-top: 1px solid #000;
                            padding-top: 5px;
                            margin-top: 5px;
                        }
                        .payment-info {
                            margin-bottom: 10px;
                        }
                        .footer {
                            text-align: center;
                            font-size: 10px;
                            border-top: 1px dashed #000;
                            padding-top: 10px;
                        }
                        @media print {
                            body { margin: 0; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <div class="store-name">${storeInfo.name}</div>
                        <div class="store-info">${storeInfo.address}</div>
                        <div class="store-info">Telp: ${storeInfo.phone}</div>
                    </div>
                    
                    <div class="transaction-info">
                        <div>No. Transaksi: ${transaction.id}</div>
                        <div>Tanggal: ${receiptDate}</div>
                        <div>Kasir: ${transaction.cashier}</div>
                    </div>
                    
                    <div class="items">
                        ${transaction.items.map(item => `
                            <div class="item">
                                <div class="item-name">${item.name}</div>
                                <div class="item-qty">${item.quantity}</div>
                                <div class="item-price">${formatCurrency(item.price * item.quantity)}</div>
                            </div>
                            <div style="font-size: 10px; color: #666; margin-left: 10px;">
                                ${formatCurrency(item.price)} x ${item.quantity}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="totals">
                        <div class="total-line">
                            <span>Subtotal:</span>
                            <span>${formatCurrency(transaction.subtotal)}</span>
                        </div>
                        ${transaction.tax > 0 ? `
                            <div class="total-line">
                                <span>Pajak (${taxPercentage}%):</span>
                                <span>${formatCurrency(transaction.tax)}</span>
                            </div>
                        ` : ''}
                        <div class="total-line grand-total">
                            <span>TOTAL:</span>
                            <span>${formatCurrency(transaction.total)}</span>
                        </div>
                    </div>
                    
                    <div class="payment-info">
                        <div class="total-line">
                            <span>Bayar (${transaction.paymentMethod === 'cash' ? 'Tunai' : 'Transfer'}):</span>
                            <span>${formatCurrency(transaction.paymentAmount)}</span>
                        </div>
                        <div class="total-line">
                            <span>Kembalian:</span>
                            <span>${formatCurrency(transaction.change)}</span>
                        </div>
                    </div>
                    
                    <div class="footer">
                        <div>Terima kasih atas kunjungan Anda!</div>
                        <div>Barang yang sudah dibeli tidak dapat dikembalikan</div>
                        <div style="margin-top: 10px;">*** STRUK PEMBAYARAN ***</div>
                    </div>
                </body>
                </html>
            `;
        }

        function updateTransactionDate() {
            const transactionDateElement = document.getElementById('transactionDate');
            if (transactionDateElement) {
                transactionDateElement.textContent = new Date().toLocaleDateString('id-ID');
            }
        }

        // Reports functionality
        function renderTransactionHistory() {
            const tableBody = document.getElementById('transactionHistory');
            if (!tableBody) return;
            
            if (transactions.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                            Belum ada transaksi
                        </td>
                    </tr>
                `;
                return;
            }
            
            const sortedTransactions = transactions
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 50); // Show last 50 transactions
            
            tableBody.innerHTML = sortedTransactions.map(transaction => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${transaction.id}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(transaction.date)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(transaction.total)}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${transaction.cashier}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex space-x-2">
                            <button onclick="viewTransactionDetail('${transaction.id}')" class="text-blue-600 hover:text-blue-900">Detail</button>
                            <button onclick="reprintReceipt('${transaction.id}')" class="text-green-600 hover:text-green-900">Cetak Struk</button>
                            <button onclick="deleteTransaction('${transaction.id}')" class="text-red-600 hover:text-red-900 ${userRole === 'admin' ? '' : 'hidden'}">Hapus</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function viewTransactionDetail(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) {
                alert('Transaksi tidak ditemukan!');
                return;
            }
            
            const transactionDate = new Date(transaction.date).toLocaleString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            const detailContent = document.getElementById('transactionDetailContent');
            detailContent.innerHTML = `
                <div class="space-y-6">
                    <!-- Transaction Header -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 border border-blue-200">
                        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                            <div>
                                <h4 class="text-2xl font-bold text-gray-900 mb-2">Transaksi #${transaction.id}</h4>
                                <p class="text-gray-600">${transactionDate}</p>
                            </div>
                            <div class="mt-4 md:mt-0">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                                     Selesai
                                </span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white rounded-lg p-4 border">
                                <p class="text-sm text-gray-600 mb-1">Kasir</p>
                                <p class="font-semibold text-gray-900">${transaction.cashier}</p>
                            </div>
                            <div class="bg-white rounded-lg p-4 border">
                                <p class="text-sm text-gray-600 mb-1">Metode Pembayaran</p>
                                <p class="font-semibold text-gray-900">${transaction.paymentMethod === 'cash' ? ' Tunai' : ' Transfer'}</p>
                            </div>
                            <div class="bg-white rounded-lg p-4 border">
                                <p class="text-sm text-gray-600 mb-1">Total Item</p>
                                <p class="font-semibold text-gray-900">${transaction.items.reduce((sum, item) => sum + item.quantity, 0)} unit</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Items List -->
                    <div class="bg-white border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-gray-50 px-6 py-4 border-b">
                            <h5 class="text-lg font-semibold text-gray-900">Detail Produk</h5>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Produk</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga Satuan</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subtotal</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${transaction.items.map(item => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${item.name}</div>
                                                ${item.deleted ? '<div class="text-xs text-red-500"> Produk telah dihapus</div>' : ''}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${formatCurrency(item.price)}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">${item.quantity}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${formatCurrency(item.price * item.quantity)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Payment Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <h5 class="text-lg font-semibold text-gray-900 mb-4">Ringkasan Pembayaran</h5>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Subtotal:</span>
                                    <span class="font-semibold text-gray-900">${formatCurrency(transaction.subtotal)}</span>
                                </div>
                                ${transaction.tax > 0 ? `
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Pajak (${taxPercentage}%):</span>
                                        <span class="font-semibold text-gray-900">${formatCurrency(transaction.tax)}</span>
                                    </div>
                                ` : ''}
                                <div class="flex justify-between text-lg font-bold border-t pt-3">
                                    <span>Total:</span>
                                    <span class="text-blue-600">${formatCurrency(transaction.total)}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white border border-gray-200 rounded-lg p-6">
                            <h5 class="text-lg font-semibold text-gray-900 mb-4">Detail Pembayaran</h5>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Jumlah Bayar:</span>
                                    <span class="font-semibold text-green-600">${formatCurrency(transaction.paymentAmount)}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Kembalian:</span>
                                    <span class="font-semibold text-purple-600">${formatCurrency(transaction.change)}</span>
                                </div>
                                <div class="flex justify-between border-t pt-3">
                                    <span class="text-gray-600">Status:</span>
                                    <span class="font-semibold text-green-600"> Lunas</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t">
                        <button onclick="reprintReceipt('${transaction.id}')" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                             Cetak Ulang Struk
                        </button>
                        <button onclick="closeTransactionDetailModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                            Tutup
                        </button>
                    </div>
                </div>
            `;
            
            // Show modal
            const modal = document.getElementById('transactionDetailModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.classList.add('modal-open');
            }
        }

        function closeTransactionDetailModal() {
            const modal = document.getElementById('transactionDetailModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.classList.remove('modal-open');
            }
        }

        function reprintReceipt(transactionId) {
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) {
                alert('Transaksi tidak ditemukan!');
                return;
            }
            
            if (confirm(`Cetak ulang struk untuk transaksi ${transaction.id}?`)) {
                printReceipt(transaction);
            }
        }

        function deleteTransaction(transactionId) {
            if (userRole !== 'admin') {
                alert('Akses ditolak! Hanya admin yang dapat menghapus transaksi.');
                return;
            }
            
            const transaction = transactions.find(t => t.id === transactionId);
            if (!transaction) {
                alert('Transaksi tidak ditemukan!');
                return;
            }
            
            if (!confirm(`Apakah Anda yakin ingin menghapus transaksi ${transaction.id}?\n\nPeringatan: Stok produk akan dikembalikan ke kondisi sebelum transaksi.`)) {
                return;
            }
            
            // Restore product stock
            transaction.items.forEach(item => {
                const product = products.find(p => p.id === item.id);
                if (product) {
                    product.stock += item.quantity;
                    console.log(`Restored ${item.quantity} units to ${product.name}, new stock: ${product.stock}`);
                }
            });
            
            // Remove transaction
            transactions = transactions.filter(t => t.id !== transactionId);
            
            // Save data
            saveData();
            
            // Update all displays
            renderTransactionHistory();
            renderInventoryTable();
            renderProductGrid();
            renderDatabaseProductTable();
            updateDashboard();
            
            alert(`Transaksi ${transaction.id} berhasil dihapus dan stok produk telah dikembalikan!`);
        }

        // Modal functionality
        function showAddProductModal() {
            const modal = document.getElementById('addProductModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.classList.add('modal-open');
                
                // Set today's date
                const today = new Date().toISOString().split('T')[0];
                const purchaseDateInput = document.getElementById('productPurchaseDate');
                if (purchaseDateInput) purchaseDateInput.value = today;
            }
        }

        function closeAddProductModal() {
            const modal = document.getElementById('addProductModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.classList.remove('modal-open');
                
                // Reset form
                document.getElementById('addProductForm').reset();
            }
        }

        function deleteDatabaseProduct(productId) {
            if (userRole !== 'admin') {
                alert('Akses ditolak! Hanya admin yang dapat menghapus produk dari database.');
                return;
            }
            
            const product = products.find(p => p.id === productId);
            if (!product) {
                alert('Produk tidak ditemukan!');
                return;
            }
            
            // Check if product has been sold in any transaction
            const productInTransactions = transactions.some(transaction => 
                transaction.items.some(item => item.id === productId)
            );
            
            let confirmMessage = `Apakah Anda yakin ingin menghapus produk "${product.name}" dari database?`;
            
            if (productInTransactions) {
                confirmMessage += `\n\nPeringatan: Produk ini pernah dijual dalam transaksi. Menghapus produk akan mempengaruhi data historis transaksi.`;
            }
            
            if (!confirm(confirmMessage)) {
                return;
            }
            
            // Remove product from products array
            products = products.filter(p => p.id !== productId);
            
            // Remove product from cart if exists
            cart = cart.filter(item => item.id !== productId);
            
            // Update transaction items to mark as deleted product
            transactions.forEach(transaction => {
                transaction.items.forEach(item => {
                    if (item.id === productId) {
                        item.name = `${item.name} (PRODUK DIHAPUS)`;
                        item.deleted = true;
                    }
                });
            });
            
            // Save data
            saveData();
            
            // Update all displays
            renderInventoryTable();
            renderProductGrid();
            renderDatabaseProductTable();
            renderTransactionHistory();
            updateDashboard();
            
            alert(`Produk "${product.name}" berhasil dihapus dari database!`);
        }

        // Database product table rendering
        function renderDatabaseProductTable() {
            const tableBody = document.getElementById('databaseProductTable');
            if (!tableBody) return;
            
            const searchTerm = document.getElementById('databaseSearchProduct')?.value.toLowerCase() || '';
            const categoryFilter = document.getElementById('databaseCategoryFilter')?.value || '';
            
            let filteredProducts = products.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                    product.code.toLowerCase().includes(searchTerm);
                const matchesCategory = !categoryFilter || product.category === categoryFilter;
                return matchesSearch && matchesCategory;
            });
            
            if (filteredProducts.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-3 py-4 text-center text-gray-500 text-sm">
                            ${products.length === 0 ? 'Belum ada produk' : 'Tidak ada produk yang sesuai filter'}
                        </td>
                    </tr>
                `;
                return;
            }
            
            tableBody.innerHTML = filteredProducts.map(product => {
                const stockClass = product.stock <= 5 ? 'text-red-600' : product.stock <= 10 ? 'text-yellow-600' : 'text-green-600';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-3 py-2 whitespace-nowrap text-xs font-medium text-gray-900">${product.code}</td>
                        <td class="px-3 py-2 text-xs text-gray-900">${product.name}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-xs text-gray-500">${product.category}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-xs font-medium ${stockClass}">${product.stock}</td>
                        <td class="px-3 py-2 whitespace-nowrap text-xs">
                            <div class="flex space-x-2">
                                <button onclick="showProductDetail('${product.id}')" class="text-green-600 hover:text-green-900 font-medium">Detail</button>
                                <button onclick="deleteDatabaseProduct('${product.id}')" class="text-red-600 hover:text-red-900 font-medium ${userRole === 'admin' ? '' : 'hidden'}">Hapus</button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Category management
        function populateCategoryDropdowns() {
            const dropdowns = ['productCategory', 'inputProductCategory', 'databaseCategoryFilter'];
            
            dropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    const currentValue = dropdown.value;
                    
                    if (dropdownId === 'databaseCategoryFilter') {
                        dropdown.innerHTML = '<option value="">Semua Kategori</option>';
                    } else {
                        dropdown.innerHTML = '<option value="">Pilih Kategori</option>';
                    }
                    
                    categories.forEach(category => {
                        const option = document.createElement('option');
                        option.value = category;
                        option.textContent = category;
                        dropdown.appendChild(option);
                    });
                    
                    // Restore previous value if it exists
                    if (currentValue && categories.includes(currentValue)) {
                        dropdown.value = currentValue;
                    }
                }
            });
            
            // Update category list in settings
            renderCategoryList();
            
            // Update database product table
            renderDatabaseProductTable();
        }

        function renderCategoryList() {
            const categoryList = document.getElementById('categoryList');
            if (!categoryList) return;
            
            if (categories.length === 0) {
                categoryList.innerHTML = '<p class="text-gray-500 text-sm">Belum ada kategori</p>';
                return;
            }
            
            categoryList.innerHTML = categories.map(category => `
                <div class="flex justify-between items-center p-2 bg-gray-50 rounded-lg">
                    <span class="text-sm text-gray-900">${category}</span>
                    <button onclick="deleteCategory('${category}')" class="text-red-600 hover:text-red-800 text-xs px-2 py-1 rounded ${userRole === 'kasir' ? 'hidden' : ''}">
                        Hapus
                    </button>
                </div>
            `).join('');
        }

        function addNewCategory() {
            const newCategoryInput = document.getElementById('newCategoryName');
            if (!newCategoryInput) return;
            
            const newCategory = newCategoryInput.value.trim();
            if (!newCategory) {
                alert('Nama kategori tidak boleh kosong!');
                return;
            }
            
            if (categories.includes(newCategory)) {
                alert('Kategori sudah ada!');
                return;
            }
            
            categories.push(newCategory);
            saveData();
            
            // Clear input
            newCategoryInput.value = '';
            
            // Update displays
            populateCategoryDropdowns();
            
            alert('Kategori berhasil ditambahkan!');
        }

        function deleteCategory(categoryName) {
            if (userRole === 'kasir') {
                alert('Akses ditolak! Kasir tidak memiliki izin untuk menghapus kategori.');
                return;
            }
            
            // Check if category is being used by any product
            const productsUsingCategory = products.filter(p => p.category === categoryName);
            if (productsUsingCategory.length > 0) {
                alert(`Kategori "${categoryName}" tidak dapat dihapus karena masih digunakan oleh ${productsUsingCategory.length} produk!`);
                return;
            }
            
            if (!confirm(`Apakah Anda yakin ingin menghapus kategori "${categoryName}"?`)) return;
            
            categories = categories.filter(c => c !== categoryName);
            saveData();
            
            // Update displays
            populateCategoryDropdowns();
            
            alert('Kategori berhasil dihapus!');
        }

        // Settings functionality
        function loadStoreInfoToSettings() {
            const storeNameInput = document.getElementById('storeName');
            const storeAddressInput = document.getElementById('storeAddress');
            const storePhoneInput = document.getElementById('storePhone');
            
            if (storeNameInput) storeNameInput.value = storeInfo.name;
            if (storeAddressInput) storeAddressInput.value = storeInfo.address;
            if (storePhoneInput) storePhoneInput.value = storeInfo.phone;
        }

        function updateStoreInfo() {
            const storeNameInput = document.getElementById('storeName');
            const storeAddressInput = document.getElementById('storeAddress');
            const storePhoneInput = document.getElementById('storePhone');
            
            if (storeNameInput) storeInfo.name = storeNameInput.value;
            if (storeAddressInput) storeInfo.address = storeAddressInput.value;
            if (storePhoneInput) storeInfo.phone = storePhoneInput.value;
            
            saveData();
            alert('Informasi toko berhasil diperbarui!');
        }

        // Data management
        function backupData() {
            const data = {
                products,
                transactions,
                users,
                categories,
                settings: {
                    productCodePrefix,
                    taxEnabled,
                    taxPercentage,
                    storeInfo
                },
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `pos_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('Data berhasil dibackup!');
        }

        function restoreData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.products) products = data.products;
                        if (data.transactions) transactions = data.transactions;
                        if (data.users) users = data.users;
                        if (data.categories) categories = data.categories;
                        if (data.settings) {
                            productCodePrefix = data.settings.productCodePrefix || 'P';
                            taxEnabled = data.settings.taxEnabled !== undefined ? data.settings.taxEnabled : true;
                            taxPercentage = data.settings.taxPercentage || 10;
                            storeInfo = { ...storeInfo, ...data.settings.storeInfo };
                        }
                        
                        saveData();
                        
                        // Refresh all displays
                        updateDashboard();
                        renderInventoryTable();
                        renderProductGrid();
                        renderTransactionHistory();
                        populateCategoryDropdowns();
                        loadStoreInfoToSettings();
                        
                        alert('Data berhasil direstore!');
                    } catch (error) {
                        console.error('Error restoring data:', error);
                        alert('Error: File backup tidak valid!');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        function resetData() {
            if (userRole === 'kasir') {
                alert('Akses ditolak! Kasir tidak memiliki izin untuk mereset data sistem.');
                return;
            }
            
            if (!confirm('PERINGATAN: Ini akan menghapus SEMUA data!\n\nApakah Anda yakin ingin melanjutkan?')) return;
            
            if (!confirm('Konfirmasi sekali lagi: Semua produk, transaksi, dan pengaturan akan dihapus!')) return;
            
            // Clear all data
            products = [];
            transactions = [];
            cart = [];
            categories = [
                'Makanan', 'Minuman', 'Elektronik', 'Pakaian', 'Kesehatan & Kecantikan',
                'Peralatan Rumah Tangga', 'Olahraga & Outdoor', 'Buku & Alat Tulis',
                'Mainan & Hobi', 'Otomotif', 'Pertanian & Kebun', 'Lainnya'
            ];
            users = [
                { username: 'admin', password: 'admin123', role: 'admin' },
                { username: 'kasir', password: 'kasir123', role: 'kasir' }
            ];
            productCodePrefix = 'P';
            taxEnabled = true;
            taxPercentage = 10;
            storeInfo = {
                name: 'TOKO ABC',
                address: 'Jl. Contoh No. 123',
                phone: '021-12345678',
                email: '',
                footer: 'Terima kasih atas kunjungan Anda!'
            };
            
            saveData();
            
            // Refresh all displays
            updateDashboard();
            renderInventoryTable();
            renderProductGrid();
            renderTransactionHistory();
            populateCategoryDropdowns();
            loadStoreInfoToSettings();
            
            alert('Semua data berhasil direset!');
        }

        // Export functionality
        function exportInventory() {
            if (products.length === 0) {
                alert('Tidak ada data produk untuk diekspor!');
                return;
            }
            
            try {
                // Prepare data for export
                const exportData = products.map(product => ({
                    'Kode Produk': product.code,
                    'Nama Produk': product.name,
                    'Kategori': product.category,
                    'Harga Beli': product.buyPrice,
                    'Harga Jual': product.sellPrice,
                    'Stok': product.stock,
                    'Tanggal Input': new Date(product.purchaseDate).toLocaleDateString('id-ID'),
                    'Catatan': product.notes || ''
                }));
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(exportData);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Inventory');
                
                // Generate filename with current date
                const filename = `inventory_${new Date().toISOString().split('T')[0]}.xlsx`;
                
                // Save file
                XLSX.writeFile(wb, filename);
                
                alert('Data inventory berhasil diekspor ke Excel!');
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                alert('Error: Tidak dapat mengekspor data. Pastikan library XLSX sudah dimuat.');
            }
        }

        function exportSalesReport() {
            if (transactions.length === 0) {
                alert('Tidak ada data transaksi untuk diekspor!');
                return;
            }
            
            try {
                // Prepare sales data
                const salesData = transactions.map(transaction => ({
                    'ID Transaksi': transaction.id,
                    'Tanggal': new Date(transaction.date).toLocaleDateString('id-ID'),
                    'Kasir': transaction.cashier,
                    'Subtotal': transaction.subtotal,
                    'Pajak': transaction.tax,
                    'Total': transaction.total,
                    'Metode Bayar': transaction.paymentMethod === 'cash' ? 'Tunai' : 'Transfer',
                    'Jumlah Bayar': transaction.paymentAmount,
                    'Kembalian': transaction.change
                }));
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(salesData);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Laporan Penjualan');
                
                // Generate filename
                const filename = `laporan_penjualan_${new Date().toISOString().split('T')[0]}.xlsx`;
                
                // Save file
                XLSX.writeFile(wb, filename);
                
                alert('Laporan penjualan berhasil diekspor ke Excel!');
            } catch (error) {
                console.error('Error exporting sales report:', error);
                alert('Error: Tidak dapat mengekspor laporan. Pastikan library XLSX sudah dimuat.');
            }
        }

        function exportStockReport() {
            if (products.length === 0) {
                alert('Tidak ada data produk untuk diekspor!');
                return;
            }
            
            try {
                // Prepare stock data with additional calculations
                const stockData = products.map(product => {
                    const stockValue = product.stock * product.buyPrice;
                    const potentialRevenue = product.stock * product.sellPrice;
                    const stockStatus = product.stock <= 5 ? 'Menipis' : product.stock <= 10 ? 'Sedang' : 'Aman';
                    
                    return {
                        'Kode Produk': product.code,
                        'Nama Produk': product.name,
                        'Kategori': product.category,
                        'Stok': product.stock,
                        'Status Stok': stockStatus,
                        'Harga Beli': product.buyPrice,
                        'Harga Jual': product.sellPrice,
                        'Nilai Stok': stockValue,
                        'Potensi Pendapatan': potentialRevenue,
                        'Tanggal Input': new Date(product.purchaseDate).toLocaleDateString('id-ID')
                    };
                });
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(stockData);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Laporan Stok');
                
                // Generate filename
                const filename = `laporan_stok_${new Date().toISOString().split('T')[0]}.xlsx`;
                
                // Save file
                XLSX.writeFile(wb, filename);
                
                alert('Laporan stok berhasil diekspor ke Excel!');
            } catch (error) {
                console.error('Error exporting stock report:', error);
                alert('Error: Tidak dapat mengekspor laporan. Pastikan library XLSX sudah dimuat.');
            }
        }

        function exportDatabase() {
            exportInventory();
        }

        function importDatabase() {
            alert('Fitur import database akan tersedia di versi selanjutnya.');
        }

        // Tax Settings Functions
        function loadTaxSettings() {
            const taxEnabledCheckbox = document.getElementById('taxEnabledSetting');
            const taxRateInput = document.getElementById('taxRateSetting');
            const taxCheckbox = document.getElementById('taxCheckbox');
            const taxPercentageDisplay = document.getElementById('taxPercentageDisplay');
            const currentTaxRate = document.getElementById('currentTaxRate');
            
            if (taxEnabledCheckbox) taxEnabledCheckbox.checked = taxEnabled;
            if (taxRateInput) taxRateInput.value = taxPercentage;
            if (taxCheckbox) taxCheckbox.checked = taxEnabled;
            if (taxPercentageDisplay) taxPercentageDisplay.textContent = taxPercentage + '%';
            if (currentTaxRate) currentTaxRate.textContent = taxPercentage + '%';
        }

        function updateTaxSettings() {
            const taxEnabledCheckbox = document.getElementById('taxEnabledSetting');
            const taxRateInput = document.getElementById('taxRateSetting');
            const taxCheckbox = document.getElementById('taxCheckbox');
            const taxPercentageDisplay = document.getElementById('taxPercentageDisplay');
            const currentTaxRate = document.getElementById('currentTaxRate');
            
            if (taxEnabledCheckbox) taxEnabled = taxEnabledCheckbox.checked;
            if (taxRateInput) taxPercentage = parseFloat(taxRateInput.value) || 10;
            
            // Update POS tax checkbox
            if (taxCheckbox) taxCheckbox.checked = taxEnabled;
            if (taxPercentageDisplay) taxPercentageDisplay.textContent = taxPercentage + '%';
            if (currentTaxRate) currentTaxRate.textContent = taxPercentage + '%';
            
            // Update cart totals if in POS
            updateCartTotals();
            
            // Save settings
            saveData();
            
            alert('Pengaturan pajak berhasil diperbarui!');
        }

        // Template Download Function
        function downloadTemplate() {
            try {
                // Create template data
                const templateData = [
                    {
                        'Nama Produk': 'Contoh Produk 1',
                        'Kategori': 'Makanan',
                        'Harga Beli': 5000,
                        'Harga Jual': 7000,
                        'Stok': 100,
                        'Tanggal Input': '2024-01-01',
                        'Catatan': 'Catatan produk (opsional)'
                    },
                    {
                        'Nama Produk': 'Contoh Produk 2',
                        'Kategori': 'Minuman',
                        'Harga Beli': 3000,
                        'Harga Jual': 5000,
                        'Stok': 50,
                        'Tanggal Input': '2024-01-01',
                        'Catatan': ''
                    }
                ];
                
                // Create worksheet
                const ws = XLSX.utils.json_to_sheet(templateData);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Template Import');
                
                // Add instructions sheet
                const instructions = [
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': 'Silakan ikuti petunjuk berikut:' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': '1. Isi data produk pada sheet "Template Import"' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': '2. Nama Produk: Wajib diisi, maksimal 100 karakter' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': '3. Kategori: Pilih dari kategori yang tersedia' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': '4. Harga Beli: Angka, wajib diisi' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': '5. Harga Jual: Angka, boleh kosong' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': '6. Stok: Angka, wajib diisi' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': '7. Tanggal Input: Format YYYY-MM-DD' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': '8. Catatan: Opsional, maksimal 500 karakter' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': '' },
                    { 'PETUNJUK PENGGUNAAN TEMPLATE': 'Kategori yang tersedia:' },
                    ...categories.map(cat => ({ 'PETUNJUK PENGGUNAAN TEMPLATE': `- ${cat}` }))
                ];
                
                const wsInstructions = XLSX.utils.json_to_sheet(instructions);
                XLSX.utils.book_append_sheet(wb, wsInstructions, 'Petunjuk');
                
                // Save file
                XLSX.writeFile(wb, 'template_import_produk.xlsx');
                
                alert('Template berhasil diunduh! Silakan isi data produk sesuai petunjuk.');
            } catch (error) {
                console.error('Error downloading template:', error);
                alert('Error: Tidak dapat mengunduh template. Pastikan library XLSX sudah dimuat.');
            }
        }

        // Stock Order Functions
        function showStockOrderModal() {
            const modal = document.getElementById('stockOrderModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.classList.add('modal-open');
                
                // Set today's date
                const today = new Date().toISOString().split('T')[0];
                const orderDateInput = document.getElementById('stockOrderDate');
                if (orderDateInput) orderDateInput.value = today;
                
                // Clear cart and render products
                stockOrderCart = [];
                renderStockOrderProducts();
                renderStockOrderCart();
            }
        }

        function closeStockOrderModal() {
            const modal = document.getElementById('stockOrderModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.classList.remove('modal-open');
                
                // Clear cart
                stockOrderCart = [];
            }
        }

        function renderStockOrderProducts() {
            const container = document.getElementById('stockOrderProducts');
            if (!container) return;
            
            const searchTerm = document.getElementById('stockOrderSearch')?.value.toLowerCase() || '';
            
            let filteredProducts = products.filter(product => {
                return product.name.toLowerCase().includes(searchTerm) || 
                       product.code.toLowerCase().includes(searchTerm);
            });
            
            if (filteredProducts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Tidak ada produk yang ditemukan</p>';
                return;
            }
            
            container.innerHTML = filteredProducts.map(product => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border hover:bg-gray-100 cursor-pointer" onclick="addToStockOrder('${product.id}')">
                    <div>
                        <p class="font-semibold text-gray-900">${product.name}</p>
                        <p class="text-sm text-gray-600">${product.code} - ${product.category}</p>
                        <p class="text-sm text-blue-600">Stok saat ini: ${product.stock}</p>
                    </div>
                    <button class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-sm">
                        Tambah
                    </button>
                </div>
            `).join('');
        }

        function addToStockOrder(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = stockOrderCart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                stockOrderCart.push({
                    id: productId,
                    name: product.name,
                    code: product.code,
                    category: product.category,
                    currentStock: product.stock,
                    quantity: 1
                });
            }
            
            renderStockOrderCart();
        }

        function renderStockOrderCart() {
            const container = document.getElementById('stockOrderCart');
            const submitBtn = document.getElementById('submitOrderBtn');
            
            if (!container) return;
            
            if (stockOrderCart.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Belum ada produk yang dipilih</p>';
                if (submitBtn) submitBtn.disabled = true;
                return;
            }
            
            container.innerHTML = stockOrderCart.map(item => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border">
                    <div class="flex-1">
                        <p class="font-semibold text-gray-900">${item.name}</p>
                        <p class="text-sm text-gray-600">${item.code} - Stok: ${item.currentStock}</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="updateStockOrderQuantity('${item.id}', ${item.quantity - 1})" 
                                class="w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-lg flex items-center justify-center text-sm font-bold ${item.quantity <= 1 ? 'opacity-50 cursor-not-allowed' : ''}" 
                                ${item.quantity <= 1 ? 'disabled' : ''}></button>
                        
                        <input type="number" 
                               value="${item.quantity}" 
                               min="1" 
                               onchange="updateStockOrderQuantityManual('${item.id}', this.value)" 
                               class="w-16 h-8 text-center text-sm font-semibold border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                        
                        <button onclick="updateStockOrderQuantity('${item.id}', ${item.quantity + 1})" 
                                class="w-8 h-8 bg-green-500 hover:bg-green-600 text-white rounded-lg flex items-center justify-center text-sm font-bold">+</button>
                        
                        <button onclick="removeFromStockOrder('${item.id}')" 
                                class="w-8 h-8 bg-red-500 hover:bg-red-600 text-white rounded-lg flex items-center justify-center text-sm font-bold ml-2"></button>
                    </div>
                </div>
            `).join('');
            
            if (submitBtn) submitBtn.disabled = false;
        }

        function updateStockOrderQuantity(productId, newQuantity) {
            if (newQuantity <= 0) {
                removeFromStockOrder(productId);
                return;
            }
            
            const item = stockOrderCart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                renderStockOrderCart();
            }
        }

        function updateStockOrderQuantityManual(productId, newQuantity) {
            const quantity = parseInt(newQuantity);
            
            if (isNaN(quantity) || quantity <= 0) {
                alert('Quantity harus berupa angka positif!');
                renderStockOrderCart();
                return;
            }
            
            const item = stockOrderCart.find(item => item.id === productId);
            if (item) {
                item.quantity = quantity;
                renderStockOrderCart();
            }
        }

        function removeFromStockOrder(productId) {
            stockOrderCart = stockOrderCart.filter(item => item.id !== productId);
            renderStockOrderCart();
        }

        function submitStockOrder() {
            if (stockOrderCart.length === 0) {
                alert('Belum ada produk yang dipilih untuk order!');
                return;
            }
            
            const orderDate = document.getElementById('stockOrderDate').value;
            const orderNotes = document.getElementById('stockOrderNotes').value;
            
            if (!orderDate) {
                alert('Tanggal order harus dipilih!');
                return;
            }
            
            const stockOrder = {
                id: 'SO' + Date.now(),
                date: orderDate,
                items: [...stockOrderCart],
                notes: orderNotes,
                status: 'pending',
                createdBy: currentUser,
                createdAt: new Date().toISOString()
            };
            
            pendingOrders.push(stockOrder);
            saveData();
            
            alert(`Stock order ${stockOrder.id} berhasil dibuat! Order akan menunggu approval penerimaan barang.`);
            
            closeStockOrderModal();
            
            // Show receive modal for immediate processing if desired
            if (confirm('Apakah Anda ingin langsung memproses penerimaan barang untuk order ini?')) {
                showStockReceiveModal(stockOrder.id);
            }
        }

        function showStockReceiveModal(orderId) {
            const order = pendingOrders.find(o => o.id === orderId);
            if (!order) {
                alert('Order tidak ditemukan!');
                return;
            }
            
            const modal = document.getElementById('stockReceiveModal');
            const content = document.getElementById('stockReceiveContent');
            
            if (!modal || !content) return;
            
            const today = new Date().toISOString().split('T')[0];
            
            content.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-900 mb-2">Order #${order.id}</h4>
                        <p class="text-sm text-blue-700">Tanggal Order: ${new Date(order.date).toLocaleDateString('id-ID')}</p>
                        <p class="text-sm text-blue-700">Dibuat oleh: ${order.createdBy}</p>
                        ${order.notes ? `<p class="text-sm text-blue-700 mt-2">Catatan: ${order.notes}</p>` : ''}
                    </div>
                    
                    <div>
                        <h5 class="font-semibold text-gray-900 mb-3">Daftar Produk yang Dipesan</h5>
                        <div class="space-y-3">
                            ${order.items.map(item => `
                                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg border">
                                    <div>
                                        <p class="font-semibold text-gray-900">${item.name}</p>
                                        <p class="text-sm text-gray-600">${item.code} - Stok saat ini: ${item.currentStock}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-semibold text-orange-600">Order: ${item.quantity} unit</p>
                                        <input type="number" 
                                               value="${item.quantity}" 
                                               min="0" 
                                               max="${item.quantity}"
                                               id="receive_${item.id}"
                                               class="w-20 h-8 text-center text-sm border-2 border-gray-300 rounded mt-1"
                                               placeholder="Terima">
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">Tanggal Penerimaan</label>
                            <input type="date" id="receiveDate" value="${today}" class="form-control w-full" required>
                        </div>
                        <div>
                            <label class="form-label">Diterima oleh</label>
                            <input type="text" id="receivedBy" value="${currentUser}" class="form-control w-full" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="form-label">Catatan Penerimaan</label>
                        <textarea id="receiveNotes" class="form-control w-full" rows="3" placeholder="Catatan penerimaan barang (opsional)"></textarea>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t">
                        <button onclick="processStockReceive('${order.id}')" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                            Proses Penerimaan
                        </button>
                        <button onclick="closeStockReceiveModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                            Batal
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            document.body.classList.add('modal-open');
        }

        function closeStockReceiveModal() {
            const modal = document.getElementById('stockReceiveModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.classList.remove('modal-open');
            }
        }

        function processStockReceive(orderId) {
            const order = pendingOrders.find(o => o.id === orderId);
            if (!order) {
                alert('Order tidak ditemukan!');
                return;
            }
            
            const receiveDate = document.getElementById('receiveDate').value;
            const receivedBy = document.getElementById('receivedBy').value;
            const receiveNotes = document.getElementById('receiveNotes').value;
            
            if (!receiveDate || !receivedBy) {
                alert('Tanggal penerimaan dan nama penerima harus diisi!');
                return;
            }
            
            let totalReceived = 0;
            const receivedItems = [];
            
            // Process each item
            order.items.forEach(item => {
                const receiveInput = document.getElementById(`receive_${item.id}`);
                const receivedQty = parseInt(receiveInput.value) || 0;
                
                if (receivedQty > 0) {
                    // Update product stock
                    const product = products.find(p => p.id === item.id);
                    if (product) {
                        product.stock += receivedQty;
                    }
                    
                    receivedItems.push({
                        ...item,
                        receivedQuantity: receivedQty
                    });
                    
                    totalReceived += receivedQty;
                }
            });
            
            if (totalReceived === 0) {
                alert('Tidak ada barang yang diterima!');
                return;
            }
            
            // Create stock receive record
            const stockReceive = {
                id: 'SR' + Date.now(),
                orderId: order.id,
                receiveDate: receiveDate,
                receivedBy: receivedBy,
                items: receivedItems,
                notes: receiveNotes,
                totalReceived: totalReceived,
                createdAt: new Date().toISOString()
            };
            
            // Move to completed orders
            stockOrders.push({
                ...order,
                status: 'completed',
                receiveInfo: stockReceive
            });
            
            // Remove from pending orders
            pendingOrders = pendingOrders.filter(o => o.id !== orderId);
            
            // Save data
            saveData();
            
            // Update displays
            renderInventoryTable();
            renderProductGrid();
            renderDatabaseProductTable();
            updateDashboard();
            
            alert(`Penerimaan stok berhasil diproses!\n\nTotal barang diterima: ${totalReceived} unit\nStok produk telah diperbarui.`);
            
            closeStockReceiveModal();
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('id-ID', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Close modals when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                const modals = document.querySelectorAll('.modal-overlay');
                modals.forEach(modal => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                });
                document.body.classList.remove('modal-open');
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // ESC to close modals
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal-overlay:not(.hidden)');
                modals.forEach(modal => {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                });
                document.body.classList.remove('modal-open');
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96c6e272642ff922',t:'MTc1NDczODY0MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
